<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:jpa="http://www.springframework.org/schema/data/jpa"
       xmlns:repo="http://www.springframework.org/schema/data/repository"
       xmlns:tx="http://www.springframework.org/schema/tx"
       xsi:schemaLocation="http://www.springframework.org/schema/beans 
       					   http://www.springframework.org/schema/beans/spring-beans.xsd
       					   http://www.springframework.org/schema/data/jpa 
       					   http://www.springframework.org/schema/data/jpa/spring-jpa.xsd
       					   http://www.springframework.org/schema/data/repository 
       					   http://www.springframework.org/schema/data/repository/spring-repository.xsd
       					   http://www.springframework.org/schema/tx 
       					   http://www.springframework.org/schema/tx/spring-tx-3.1.xsd">

    <!-- replacement of DAO as spring bean -->
    <bean id="datasourceDAO" class="org.reporte.datasource.dao.impl.DatasourceDAOImpl"/>
    <bean id="databaseTypeDAO" class="org.reporte.datasource.dao.impl.DatabaseTypeDAOImpl"/>

    <bean id="modelDAO" class="org.reporte.model.dao.impl.ModelDAOImpl" />
    
    <bean id="reportQueryDAO" class="org.reporte.reporttemplate.dao.impl.ReportQueryDAOImpl"/>
    <bean id="reportTemplateDAO" class="org.reporte.reporttemplate.dao.impl.ReportTemplateDAOImpl"/>
    
    <!-- replacement of Session bean as spring bean -->
    <bean id="databaseTypeService" class="org.reporte.datasource.service.impl.DatabaseTypeHandlerImpl"/>
    <bean id="datasourceService" class="org.reporte.datasource.service.impl.DatasourceHandlerImpl"/>
	<bean id="jdbcClientService" class="org.reporte.datasource.service.impl.JdbcClientImpl"/>

    <bean id="modelService" class="org.reporte.model.service.impl.ModelServiceImpl"/>
    
    <bean id="reportTemplateService" class="org.reporte.reporttemplate.service.impl.ReportTemplateServiceImpl"/>
    
    <bean id="reportGenService" class="org.reporte.report.service.impl.ReportGenerationServiceImpl"/>
    
    <!-- local JPA entity facotry -->
    <bean id="entityManagerFactory"
          class="org.springframework.orm.jpa.LocalContainerEntityManagerFactoryBean">
        <property name="persistenceUnitName" value="reporte"/>
        <property name="dataSource" ref="reportEDataSource"/>
        <property name="jpaVendorAdapter">
            <bean class="org.springframework.orm.jpa.vendor.HibernateJpaVendorAdapter">
                <property name="databasePlatform" value="org.hibernate.dialect.MySQL5InnoDBDialect"/>
                <property name="database" value="MYSQL"/>
            </bean>
        </property>
        <property name="persistenceXmlLocation" value="classpath:spring/persistence.xml"/>
    </bean>
    
    <bean id="reportEDataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
        <property name="jndiName" value="java:comp/env/jdbc/MySQLDS"/>
        <property name="lookupOnStartup" value="false"/>
        <property name="cache" value="true"/>
        <property name="proxyInterface" value="javax.sql.DataSource"/>
    </bean>
    
    <bean class="org.springframework.orm.jpa.support.PersistenceAnnotationBeanPostProcessor" />

	<!-- Transaction configuration. -->
    <bean id="transactionManager" class="org.springframework.orm.jpa.JpaTransactionManager">
         <property name="entityManagerFactory" ref="entityManagerFactory"/>
    </bean>
    
    <tx:annotation-driven transaction-manager="transactionManager"/>
    
    <tx:advice id="txAdvice" transaction-manager="transactionManager">
        <tx:attributes>
            <tx:method name="*" rollback-for="java.lang.Exception"/>
        </tx:attributes>
    </tx:advice>
</beans>